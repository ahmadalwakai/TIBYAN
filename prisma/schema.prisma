generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
  engineType    = "binary"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["admins", "ai", "public", "students", "teachers"]
}

model admin_roles {
  id          String   @id
  name        String   @unique
  nameAr      String
  description String?
  permissions Json
  isSystem    Boolean  @default(false)
  status      String   @default("active")
  createdAt   DateTime @default(now())
  updatedAt   DateTime

  @@schema("admins")
}

model audit_logs {
  id          String   @id
  actorUserId String?
  action      String
  entityType  String?
  entityId    String?
  metadata    Json?
  createdAt   DateTime @default(now())
  users       users?   @relation(fields: [actorUserId], references: [id])

  @@index([action])
  @@index([actorUserId])
  @@index([createdAt])
  @@schema("admins")
}

model notifications {
  id          String              @id
  title       String
  content     String
  channel     NotificationChannel @default(EMAIL)
  status      NotificationStatus  @default(DRAFT)
  targetType  NotificationTarget  @default(ALL_USERS)
  scheduledAt DateTime?
  sentAt      DateTime?
  createdBy   String?
  createdAt   DateTime            @default(now())
  updatedAt   DateTime

  @@index([channel])
  @@index([status])
  @@schema("admins")
}

model system_settings {
  id          String   @id
  key         String   @unique
  value       Json
  category    String   @default("general")
  description String?
  updatedAt   DateTime
  updatedBy   String?

  @@index([category])
  @@schema("admins")
}

model blog_post_media {
  id         String     @id
  postId     String
  type       MediaType
  url        String
  filename   String?
  mimeType   String?
  fileSize   Int?
  width      Int?
  height     Int?
  duration   Int?
  caption    String?
  altText    String?
  order      Int        @default(0)
  styling    Json?
  createdAt  DateTime   @default(now())
  blog_posts blog_posts @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@schema("public")
}

model blog_posts {
  id              String            @id
  title           String
  slug            String            @unique
  content         String
  excerpt         String?
  styling         Json?
  authorId        String
  status          PostStatus        @default(DRAFT)
  visibility      BlogVisibility    @default(PUBLIC)
  featured        Boolean           @default(false)
  allowComments   Boolean           @default(true)
  tags            String[]          @default([])
  likesCount      Int               @default(0)
  commentsCount   Int               @default(0)
  viewsCount      Int               @default(0)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  publishedAt     DateTime?
  blog_post_media blog_post_media[]
  users           users             @relation(fields: [authorId], references: [id], onDelete: Cascade)

  @@index([authorId])
  @@index([createdAt])
  @@index([featured])
  @@index([slug])
  @@index([status])
  @@schema("public")
}

model comment_likes {
  id            String        @id
  commentId     String
  userId        String
  createdAt     DateTime      @default(now())
  post_comments post_comments @relation(fields: [commentId], references: [id], onDelete: Cascade)

  @@unique([commentId, userId])
  @@index([commentId])
  @@index([userId])
  @@schema("public")
}

model email_verification_codes {
  id        String                  @id
  email     String
  code      String                  @unique
  purpose   VerificationCodePurpose @default(ADMIN_LOGIN)
  expiresAt DateTime
  usedAt    DateTime?
  createdAt DateTime                @default(now())

  @@index([code])
  @@index([email])
  @@schema("public")
}

model member_announcements {
  id        String   @id
  title     String
  body      String
  createdAt DateTime @default(now())

  @@schema("public")
}

model member_resources {
  id              String             @id
  title           String
  type            MemberResourceType @default(LINK)
  url             String?
  content         String?
  createdByUserId String
  createdAt       DateTime           @default(now())
  users           users              @relation(fields: [createdByUserId], references: [id])

  @@index([createdByUserId])
  @@schema("public")
}

model member_support_tickets {
  id        String              @id
  userId    String
  subject   String
  message   String
  status    MemberSupportStatus @default(OPEN)
  createdAt DateTime            @default(now())
  users     users               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@schema("public")
}

model post_comments {
  id                  String          @id
  postId              String
  authorId            String
  authorName          String
  authorAvatar        String?
  content             String
  parentId            String?
  status              CommentStatus   @default(APPROVED)
  likesCount          Int             @default(0)
  createdAt           DateTime        @default(now())
  updatedAt           DateTime
  comment_likes       comment_likes[]
  post_comments       post_comments?  @relation("post_commentsTopost_comments", fields: [parentId], references: [id], onDelete: Cascade)
  other_post_comments post_comments[] @relation("post_commentsTopost_comments")
  posts               posts           @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([authorId])
  @@index([parentId])
  @@index([postId])
  @@schema("public")
}

model post_likes {
  id        String   @id
  postId    String
  userId    String
  createdAt DateTime @default(now())
  posts     posts    @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@unique([postId, userId])
  @@index([postId])
  @@index([userId])
  @@schema("public")
}

model post_media {
  id        String    @id
  postId    String
  type      MediaType
  url       String
  filename  String?
  mimeType  String?
  fileSize  Int?
  width     Int?
  height    Int?
  duration  Int?
  caption   String?
  altText   String?
  order     Int       @default(0)
  styling   Json?
  createdAt DateTime  @default(now())
  posts     posts     @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@schema("public")
}

model posts {
  id            String          @id
  title         String?
  content       String
  excerpt       String?
  styling       Json?
  authorId      String
  authorType    AuthorType      @default(ADMIN)
  status        PostStatus      @default(DRAFT)
  visibility    PostVisibility  @default(PUBLIC)
  isPinned      Boolean         @default(false)
  allowComments Boolean         @default(true)
  allowLikes    Boolean         @default(true)
  likesCount    Int             @default(0)
  commentsCount Int             @default(0)
  viewsCount    Int             @default(0)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime
  publishedAt   DateTime?
  post_comments post_comments[]
  post_likes    post_likes[]
  post_media    post_media[]

  @@index([authorId])
  @@index([createdAt])
  @@index([isPinned, publishedAt])
  @@index([status])
  @@schema("public")
}

model user_notifications {
  id            String               @id
  userId        String
  type          UserNotificationType
  title         String
  message       String
  link          String?
  referenceType String?
  referenceId   String?
  isRead        Boolean              @default(false)
  readAt        DateTime?
  createdAt     DateTime             @default(now())

  @@index([createdAt])
  @@index([isRead])
  @@index([userId])
  @@schema("public")
}

model users {
  id                     String                   @id
  email                  String                   @unique
  name                   String
  password               String
  role                   Role                     @default(STUDENT)
  status                 UserStatus               @default(ACTIVE)
  emailVerified          Boolean                  @default(false)
  avatar                 String?
  bio                    String?
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  lastActiveAt           DateTime                 @default(now())
  notificationPrefs      Json?
  membershipStatus       MembershipStatus         @default(ACTIVE)
  membershipPlan         String?
  membershipExpiresAt    DateTime?
  membershipPerks        Json?
  audit_logs             audit_logs[]
  blog_posts             blog_posts[]
  member_resources       member_resources[]
  member_support_tickets member_support_tickets[]
  verification_tokens    verification_tokens[]
  certificates           certificates[]
  enrollments            enrollments[]
  payments               payments[]
  reviews                reviews[]
  courses                courses[]

  @@schema("public")
}

model verification_tokens {
  id        String       @id
  token     String       @unique
  purpose   TokenPurpose
  userId    String
  expiresAt DateTime
  usedAt    DateTime?
  createdAt DateTime     @default(now())
  users     users        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([userId])
  @@schema("public")
}

model certificates {
  id                String   @id
  certificateNumber String   @unique
  studentName       String
  studentNameEn     String?
  courseName        String
  courseNameEn      String?
  completionDate    DateTime
  grade             String?
  score             Float?
  instructorName    String?
  courseDuration    String?
  templateType      String   @default("classic")
  userId            String?
  courseId          String?
  issuedBy          String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime
  courses           courses? @relation(fields: [courseId], references: [id])
  users             users?   @relation(fields: [userId], references: [id])

  @@index([certificateNumber])
  @@index([courseName])
  @@index([studentName])
  @@schema("students")
}

model enrollments {
  id          String           @id
  userId      String
  courseId    String
  status      EnrollmentStatus @default(ACTIVE)
  progress    Float            @default(0)
  enrolledAt  DateTime         @default(now())
  completedAt DateTime?
  courses     courses          @relation(fields: [courseId], references: [id], onDelete: Cascade)
  users       users            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, courseId])
  @@schema("students")
}

model payments {
  id             String        @id
  userId         String
  courseId       String
  amount         Float
  currency       String        @default("SAR")
  status         PaymentStatus @default(PENDING)
  paymentMethod  String?
  transactionId  String?
  couponCode     String?
  discountAmount Float         @default(0)
  customerName   String?
  customerEmail  String?
  customerPhone  String?
  notes          String?
  paidAt         DateTime?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime
  courses        courses       @relation(fields: [courseId], references: [id], onDelete: Cascade)
  users          users         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@schema("students")
}

model reviews {
  id        String   @id
  rating    Int
  comment   String?
  userId    String
  courseId  String
  createdAt DateTime @default(now())
  updatedAt DateTime
  courses   courses  @relation(fields: [courseId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, courseId])
  @@schema("students")
}

model courses {
  id           String         @id
  title        String
  slug         String         @unique
  description  String
  thumbnail    String?
  status       CourseStatus   @default(DRAFT)
  price        Float          @default(0)
  duration     Int?
  level        CourseLevel    @default(BEGINNER)
  instructorId String
  createdAt    DateTime       @default(now())
  updatedAt    DateTime
  publishedAt  DateTime?
  certificates certificates[]
  enrollments  enrollments[]
  payments     payments[]
  reviews      reviews[]
  users        users          @relation(fields: [instructorId], references: [id], onDelete: Cascade)
  lessons      lessons[]

  @@schema("teachers")
}

model lessons {
  id          String   @id
  title       String
  description String?
  content     String
  videoUrl    String?
  duration    Int?
  order       Int
  courseId    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  courses     courses  @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@schema("teachers")
}

model meeting_chat_messages {
  id               String           @id
  meetingId        String
  content          String
  authorId         String
  authorName       String
  authorAvatar     String?
  createdAt        DateTime         @default(now())
  teacher_meetings teacher_meetings @relation(fields: [meetingId], references: [id], onDelete: Cascade)

  @@index([meetingId])
  @@schema("teachers")
}

model meeting_invitations {
  id               String           @id
  meetingId        String
  userId           String
  userName         String
  userEmail        String
  userRole         Role
  status           InvitationStatus @default(PENDING)
  respondedAt      DateTime?
  emailSent        Boolean          @default(false)
  emailSentAt      DateTime?
  notificationSent Boolean          @default(false)
  createdAt        DateTime         @default(now())
  teacher_meetings teacher_meetings @relation(fields: [meetingId], references: [id], onDelete: Cascade)

  @@unique([meetingId, userId])
  @@index([status])
  @@index([userId])
  @@schema("teachers")
}

model meeting_participants {
  id               String           @id
  meetingId        String
  userId           String
  userName         String
  userAvatar       String?
  userRole         Role
  joinedAt         DateTime?
  leftAt           DateTime?
  isActive         Boolean          @default(false)
  isMuted          Boolean          @default(false)
  isCameraOff      Boolean          @default(false)
  isHandRaised     Boolean          @default(false)
  canSpeak         Boolean          @default(true)
  canShare         Boolean          @default(false)
  isCoHost         Boolean          @default(false)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime
  teacher_meetings teacher_meetings @relation(fields: [meetingId], references: [id], onDelete: Cascade)

  @@unique([meetingId, userId])
  @@schema("teachers")
}

model message_reactions {
  id                    String                @id
  emoji                 String
  userId                String
  userName              String
  messageId             String
  createdAt             DateTime              @default(now())
  teacher_room_messages teacher_room_messages @relation(fields: [messageId], references: [id], onDelete: Cascade)

  @@unique([messageId, userId, emoji])
  @@schema("teachers")
}

model session_chat_messages {
  id                String            @id
  sessionId         String
  content           String
  authorId          String
  authorName        String
  authorAvatar      String?
  authorRole        Role
  createdAt         DateTime          @default(now())
  teaching_sessions teaching_sessions @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@schema("teachers")
}

model session_invitations {
  id                String            @id
  sessionId         String
  userId            String
  userName          String
  userEmail         String
  userRole          Role
  status            InvitationStatus  @default(PENDING)
  respondedAt       DateTime?
  emailSent         Boolean           @default(false)
  emailSentAt       DateTime?
  notificationSent  Boolean           @default(false)
  createdAt         DateTime          @default(now())
  teaching_sessions teaching_sessions @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@unique([sessionId, userId])
  @@index([status])
  @@index([userId])
  @@schema("teachers")
}

model session_participants {
  id                String            @id
  sessionId         String
  userId            String
  userName          String
  userAvatar        String?
  userRole          Role
  isActive          Boolean           @default(false)
  joinedAt          DateTime?
  leftAt            DateTime?
  isMuted           Boolean           @default(true)
  isCameraOff       Boolean           @default(true)
  isHandRaised      Boolean           @default(false)
  canSpeak          Boolean           @default(false)
  canShare          Boolean           @default(false)
  createdAt         DateTime          @default(now())
  teaching_sessions teaching_sessions @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@unique([sessionId, userId])
  @@index([userId])
  @@schema("teachers")
}

model teacher_applications {
  id                String            @id
  fullName          String
  email             String
  phone             String
  dateOfBirth       String?
  nationality       String?
  gender            String?
  degree            String?
  fieldOfStudy      String?
  university        String?
  graduationYear    String?
  yearsExperience   String?
  subjectsToTeach   String
  quranMemorization String?
  tajweedLevel      String?
  onlineExperience  String?
  availableDays     String?
  hoursPerWeek      String?
  startDate         String?
  motivation        String?
  expectedSalary    String?
  status            ApplicationStatus @default(PENDING)
  reviewedBy        String?
  reviewedAt        DateTime?
  reviewNotes       String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime

  @@schema("teachers")
}

model teacher_meetings {
  id                    String                  @id
  title                 String
  description           String?
  type                  MeetingType             @default(VIDEO)
  status                MeetingStatus           @default(SCHEDULED)
  scheduledAt           DateTime?
  startedAt             DateTime?
  endedAt               DateTime?
  duration              Int?
  hostId                String
  hostName              String
  hostAvatar            String?
  isRecorded            Boolean                 @default(false)
  recordingUrl          String?
  maxParticipants       Int                     @default(50)
  createdAt             DateTime                @default(now())
  updatedAt             DateTime
  allowChat             Boolean                 @default(true)
  allowHandRaise        Boolean                 @default(true)
  allowScreenShare      Boolean                 @default(true)
  notifyBeforeStart     Int?
  notifyOnCreate        Boolean                 @default(true)
  privacy               MeetingPrivacy          @default(PUBLIC)
  requireApproval       Boolean                 @default(false)
  meeting_chat_messages meeting_chat_messages[]
  meeting_invitations   meeting_invitations[]
  meeting_participants  meeting_participants[]

  @@index([hostId])
  @@index([privacy])
  @@index([scheduledAt])
  @@index([status])
  @@schema("teachers")
}

model teacher_room_messages {
  id                          String                  @id
  content                     String?
  type                        MessageType             @default(TEXT)
  voiceUrl                    String?
  voiceDuration               Int?
  attachmentUrl               String?
  attachmentName              String?
  attachmentType              String?
  authorId                    String
  authorName                  String
  authorAvatar                String?
  authorRole                  Role
  replyToId                   String?
  isEdited                    Boolean                 @default(false)
  isDeleted                   Boolean                 @default(false)
  isPinned                    Boolean                 @default(false)
  createdAt                   DateTime                @default(now())
  updatedAt                   DateTime
  message_reactions           message_reactions[]
  teacher_room_messages       teacher_room_messages?  @relation("teacher_room_messagesToteacher_room_messages", fields: [replyToId], references: [id])
  other_teacher_room_messages teacher_room_messages[] @relation("teacher_room_messagesToteacher_room_messages")

  @@index([authorId])
  @@index([createdAt])
  @@schema("teachers")
}

model teaching_sessions {
  id                    String                  @id
  title                 String
  description           String?
  type                  MeetingType             @default(VIDEO)
  status                MeetingStatus           @default(SCHEDULED)
  scheduledAt           DateTime?
  startedAt             DateTime?
  endedAt               DateTime?
  duration              Int?
  teacherId             String
  teacherName           String
  teacherAvatar         String?
  courseId              String?
  courseName            String?
  isRecorded            Boolean                 @default(false)
  recordingUrl          String?
  maxStudents           Int                     @default(30)
  privacy               MeetingPrivacy          @default(PRIVATE)
  requireApproval       Boolean                 @default(false)
  allowChat             Boolean                 @default(true)
  allowScreenShare      Boolean                 @default(true)
  allowHandRaise        Boolean                 @default(true)
  allowStudentMic       Boolean                 @default(false)
  allowStudentCamera    Boolean                 @default(false)
  notifyOnCreate        Boolean                 @default(true)
  notifyBeforeStart     Int?
  createdAt             DateTime                @default(now())
  updatedAt             DateTime
  session_chat_messages session_chat_messages[]
  session_invitations   session_invitations[]
  session_participants  session_participants[]

  @@index([courseId])
  @@index([scheduledAt])
  @@index([status])
  @@index([teacherId])
  @@schema("teachers")
}

enum ApplicationStatus {
  PENDING
  UNDER_REVIEW
  APPROVED
  REJECTED

  @@schema("public")
}

enum AuthorType {
  ADMIN
  INSTRUCTOR
  MEMBER

  @@schema("public")
}

enum BlogVisibility {
  PUBLIC
  MEMBERS_ONLY
  PRIVATE

  @@schema("public")
}

enum CommentStatus {
  PENDING
  APPROVED
  REJECTED
  SPAM

  @@schema("public")
}

enum CourseLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED

  @@schema("public")
}

enum CourseStatus {
  DRAFT
  REVIEW
  PUBLISHED
  ARCHIVED

  @@schema("public")
}

enum EnrollmentStatus {
  ACTIVE
  COMPLETED
  CANCELLED

  @@schema("public")
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  DECLINED

  @@schema("public")
}

enum MediaType {
  IMAGE
  VIDEO
  AUDIO
  DOCUMENT
  PDF

  @@schema("public")
}

enum MeetingPrivacy {
  PUBLIC
  PRIVATE

  @@schema("public")
}

enum MeetingStatus {
  SCHEDULED
  LIVE
  ENDED
  CANCELLED

  @@schema("public")
}

enum MeetingType {
  VIDEO
  VOICE

  @@schema("public")
}

enum MemberResourceType {
  LINK
  DOCUMENT
  ARTICLE

  @@schema("public")
}

enum MemberSupportStatus {
  OPEN
  CLOSED

  @@schema("public")
}

enum MembershipStatus {
  ACTIVE
  TRIAL
  EXPIRED
  CANCELED

  @@schema("public")
}

enum MessageType {
  TEXT
  VOICE
  FILE
  SYSTEM

  @@schema("public")
}

enum NotificationChannel {
  EMAIL
  IN_APP
  SMS
  PUSH

  @@schema("public")
}

enum NotificationStatus {
  DRAFT
  SCHEDULED
  SENDING
  SENT
  FAILED

  @@schema("public")
}

enum NotificationTarget {
  ALL_USERS
  STUDENTS
  TEACHERS
  SPECIFIC_USERS

  @@schema("public")
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  REFUNDED
  CANCELLED

  @@schema("public")
}

enum PostStatus {
  DRAFT
  PUBLISHED
  ARCHIVED

  @@schema("public")
}

enum PostVisibility {
  PUBLIC
  TEACHERS_ONLY
  PRIVATE

  @@schema("public")
}

enum Role {
  STUDENT
  INSTRUCTOR
  ADMIN
  MEMBER

  @@schema("public")
}

enum TokenPurpose {
  EMAIL_VERIFICATION
  PASSWORD_RESET
  TEACHER_CONFIRMATION

  @@schema("public")
}

enum UserNotificationType {
  MEETING_INVITATION
  MEETING_STARTING
  MEETING_CANCELLED
  NEW_MESSAGE
  SYSTEM

  @@schema("public")
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  PENDING

  @@schema("public")
}

enum VerificationCodePurpose {
  ADMIN_LOGIN
  EMAIL_VERIFICATION
  PASSWORD_RESET

  @@schema("public")
}
